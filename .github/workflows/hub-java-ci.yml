# Caller workflow to test reusable Java CI from hub
name: "Hub: Java CI (Reusable)"

on:
  workflow_dispatch:
  push:
    branches: [main, test-phase1b-schema]
    paths:
      - 'java-*/**'
  pull_request:
    branches: [main]
    paths:
      - 'java-*/**'

permissions:
  contents: read
  security-events: write

jobs:
  ci-passing:
    name: "Java Passing"
    uses: jguida941/ci-cd-hub/.github/workflows/java-ci.yml@phase1b-workflow-schema
    with:
      java_version: '21'
      build_tool: 'maven'
      run_jacoco: true
      run_checkstyle: true
      run_spotbugs: true
      run_owasp: true
      run_pitest: true
      run_pmd: true
      run_semgrep: true
      run_trivy: true
      run_docker: true
      run_codeql: true
      coverage_min: 70
      workdir: 'java-passing'
      artifact_prefix: 'java-passing-'
    secrets: inherit

  ci-failing:
    # NOTE: Relaxed thresholds so we can see all findings in ci-report
    # This fixture is expected to have issues - we want to verify detection
    # TODO: When ready for production, set appropriate thresholds
    name: "Java Failing"
    uses: jguida941/ci-cd-hub/.github/workflows/java-ci.yml@phase1b-workflow-schema
    with:
      java_version: '21'
      build_tool: 'maven'
      run_jacoco: true
      run_checkstyle: true
      run_spotbugs: true
      run_owasp: true
      run_pitest: true
      run_pmd: true
      run_semgrep: true
      run_trivy: true
      run_docker: true
      run_codeql: true
      coverage_min: 0
      mutation_score_min: 0
      owasp_cvss_fail: 11
      max_critical_vulns: 999
      max_high_vulns: 999
      max_semgrep_findings: 999
      workdir: 'java-failing'
      artifact_prefix: 'java-failing-'
    secrets: inherit

  ci-docker:
    # Dedicated docker fixture - exercises Trivy container scan and Docker build
    # NOTE: Focus is Docker/Trivy testing, not code quality - relaxed thresholds
    name: "Java Docker"
    uses: jguida941/ci-cd-hub/.github/workflows/java-ci.yml@phase1b-workflow-schema
    with:
      java_version: '21'
      build_tool: 'maven'
      run_jacoco: true
      run_checkstyle: true
      run_spotbugs: true
      run_owasp: true
      run_pitest: false
      run_pmd: true
      run_semgrep: true
      run_trivy: true
      run_docker: true
      run_codeql: false
      coverage_min: 70
      max_high_vulns: 10
      max_semgrep_findings: 10
      workdir: 'java-with-docker'
      artifact_prefix: 'java-docker-'
    secrets: inherit
