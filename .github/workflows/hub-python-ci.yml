# Caller workflow to test reusable Python CI from hub
name: "Hub: Python CI (Reusable)"

on:
  workflow_dispatch:
  push:
    branches: [main, test-phase1b-schema]
    paths:
      - 'python-*/**'
  pull_request:
    branches: [main]
    paths:
      - 'python-*/**'

permissions:
  contents: read
  security-events: write

jobs:
  ci-passing:
    # NOTE: mutation_score_min=0 because mutmut is not detecting/running tests properly
    # TODO: Fix mutmut configuration and restore mutation_score_min=70
    name: "Python Passing"
    uses: jguida941/ci-cd-hub/.github/workflows/python-ci.yml@phase1b-workflow-schema
    with:
      python_version: '3.12'
      run_pytest: true
      run_ruff: true
      run_bandit: true
      run_pip_audit: true
      run_mypy: true
      run_black: true
      run_isort: true
      run_mutmut: true
      run_semgrep: true
      run_trivy: true
      run_docker: true
      run_codeql: true
      coverage_min: 70
      mutation_score_min: 0
      workdir: 'python-passing'
      artifact_prefix: 'python-passing-'
    secrets: inherit

  ci-failing:
    # NOTE: Relaxed thresholds so we can see all findings in ci-report
    # This fixture is expected to have issues - we want to verify detection
    # TODO: When ready for production, set appropriate thresholds
    name: "Python Failing"
    uses: jguida941/ci-cd-hub/.github/workflows/python-ci.yml@phase1b-workflow-schema
    with:
      python_version: '3.12'
      run_pytest: true
      run_ruff: true
      run_bandit: true
      run_pip_audit: true
      run_mypy: true
      run_black: true
      run_isort: true
      run_mutmut: true
      run_semgrep: true
      run_trivy: true
      run_docker: true
      run_codeql: true
      coverage_min: 0
      mutation_score_min: 0
      max_critical_vulns: 999
      max_high_vulns: 999
      max_semgrep_findings: 999
      workdir: 'python-failing'
      artifact_prefix: 'python-failing-'
    secrets: inherit

  ci-docker:
    # Dedicated docker fixture - exercises Trivy container scan and Docker build
    # NOTE: Focus is Docker/Trivy testing, not code quality - relaxed thresholds
    name: "Python Docker"
    uses: jguida941/ci-cd-hub/.github/workflows/python-ci.yml@phase1b-workflow-schema
    with:
      python_version: '3.12'
      run_pytest: true
      run_ruff: true
      run_bandit: true
      run_pip_audit: true
      run_mypy: false
      run_black: true
      run_isort: true
      run_mutmut: false
      run_semgrep: true
      run_trivy: true
      run_docker: true
      run_codeql: false
      coverage_min: 70
      max_high_vulns: 10
      max_semgrep_findings: 10
      workdir: 'python-with-docker'
      artifact_prefix: 'python-docker-'
    secrets: inherit
